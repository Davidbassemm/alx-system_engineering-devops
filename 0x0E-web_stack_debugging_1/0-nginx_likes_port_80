#!/bin/bash

# Check Nginx status
systemctl status nginx | grep running >/dev/null 2>&1
if [[ $? -ne 0 ]]; then
  echo "Error: Nginx is not running. Please start it manually."
  exit 1
fi

# Check for conflicting process on port 80
process=$(netstat -tlpn | grep ":80\sTCP.*LISTEN")
if [[ ! -z "$process" ]]; then
  pid=$(echo "$process" | awk '{print $7}')
  echo "Warning: Another process (PID: $pid) is using port 80."
  read -p "Stop this process (y/N)? " answer
  if [[ "$answer" =~ ^[Yy]$ ]]; then
    kill $pid
    echo "Process stopped."
  fi
fi

# Fix Nginx config (modify as needed for your specific configuration)
sed -i 's/listen [^:]*:\([0-9]*\);/listen 80;/' /etc/nginx/nginx.conf

# Restart Nginx
systemctl restart nginx

echo "Nginx configuration fixed (listening on port 80)."
